module.exports=function(){function z(){h("CONNECTING to "+x);k=new t(x);k.onopen=C;k.onclose=D;k.onmessage=E;k.onerror=F}function C(a){k.readyState===t.OPEN&&r(u);h("CONNECTED")}function D(a){h("DISCONNECTED")}function E(a){if("ping"!==a.data){try{var c=JSON.parse(a.data);if(c.data.hasOwnProperty("_MESSAGE_ID")&&w.hasOwnProperty(c.data._MESSAGE_ID)){var e=w[c.data._MESSAGE_ID];+new Date<e.expiration&&(delete c.data._MESSAGE_ID,e.fn(c.data));delete w[c.data._MESSAGE_ID]}else if(void 0!==p[c.recipient])p[c.recipient](c);
else h("no handler for event: "+a.data)}catch(d){h("ERROR: parse exception for event data "+a.data)}h("RESPONSE: "+a.data)}else 0<a.data.length&&k.send(".")}function F(a){A();h("ERROR: "+a)}function n(a){k&&k.readyState!==t.CONNECTING?a():setTimeout(function(){n(a)},200)}function r(a){k&&k.send(a)&&h("SENT: "+a)}function q(){return k.readyState===t.OPEN}function y(a,c){q()&&r("sendjson "+a+" "+JSON.stringify(c))}function G(a,c){q()&&B(a,function(e){var d={_MESSAGE_ID:e.data._MESSAGE_ID};c(e.data,
d);y(e.sender,d)})}function B(a,c){q()&&(r("subscribe "+a),p[a]=c)}function H(a){q()&&(r("unsubscribe "+a),p[a]=function(){})}function I(){q()||k.readyState===t.CONNECTING||(h("RECONNECTING"),z(),n(function(){for(ch in p)r("subscribe "+ch)}))}function J(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}var x="ws://localhost/ws",u,p={},w={},k,h=function(a){},A=function(){},t=require("websocket").w3cwebsocket;return{connect:function(a,
c,e){x=a;u=c&&0<c.length?c:"webclient_"+ +new Date;p[u]=e;z();setInterval(I,1E3)},send:function(a,c){n(function(){y(a,c)})},call:function(a,c,e,d){n(function(){if(q()){var b=J();w[b]={expiration:+new Date+e,fn:d};c._MESSAGE_ID=b;c._MESSAGE_HANDLE=a;r("sendjson "+a+" "+JSON.stringify(c))}})},register:function(a,c){n(function(){G(a,c)})},subscribe:function(a,c){n(function(){B(a,c)})},unsubscribe:function(a){n(function(){H(a)})},variable:function(a,c){function e(f){b.forEach(function(l){l(f)})}function d(f){arguments.length&&
f!==g&&(g=f,e(f),y(a,{name:g}));return g}var b=[],g;d.subscribe=function(f){b.push(f)};this.subscribe(a,function(f){f.data.hasOwnProperty(c)&&d(f.data[c])});return d},isConnected:function(){return q()},close:function(){n(function(){k&&k.close()})},handlers:function(){return p},logger:function(a){h=a},error:function(a){A=a},heyOOCSI:function(a){var c=a||u,e={};e[c]={};e[c].properties={device_id:u};e[c].location={};e[c].components={};var d=e[c].components;h(`Added heyOOCSI device ${c}`);return{add_property:function(b,
g){e[c].properties[b]=g},add_location:function(b,g,f){e[c].properties[b]=[g,f]},add_sensor_brick:function(b,g,f,l,m,v){d[b]={};d[b].channel_name=g;d[b].type="sensor";d[b].sensor_type=f;d[b].unit=l;d[b].value=m;d[b].icon=v;h(`Added ${b} to the components list for device ${c}.`)},add_number_brick:function(b,g,f,l,m,v){d[b]={};d[b].channel_name=g;d[b].type="number";d[b].min_max=f;d[b].unit=l;d[b].value=m;d[b].icon=v;h(`Added ${b} to the components list for device ${c}.`)},add_binary_sensor_brick:function(b,
g,f,l,m){d[b]={};d[b].channel_name=g;d[b].type="binary_sensor";d[b].sensor_type=f;d[b].state=l;d[b].icon=m;h(`Added ${b} to the components list for device ${c}.`)},add_switch_brick:function(b,g,f,l,m){d[b]={};d[b].channel_name=g;d[b].type="switch";d[b].sensor_type=f;d[b].state=l;d[b].icon=m;h(`Added ${b} to the components list for device ${c}.`)},add_light_brick:function(b,g,f,l,m,v,K,L){d[b]={};d[b].channel_name=g;d[b].type="light";d[b].ledType=f;d[b].spectrum=l;d[b].min_max=m;d[b].state=v;d[b].brightness=
K;d[b].icon=L;h(`Added ${b} to the components list for device ${c}.`)},submit:function(){OOCSI.send("heyOOCSI!",e)},sayHi:function(){OOCSI.send("heyOOCSI!",e)}}}}}();
